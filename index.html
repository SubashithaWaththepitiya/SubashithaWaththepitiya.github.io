<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mirchi Vilas - POS System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            overflow-x: hidden;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 10px;
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            padding: 15px;
            text-align: center;
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .section {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .section-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #ee5a24;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 8px;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .menu-item {
            background: #f8f8f8;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .menu-item:hover {
            background: #fff3e0;
            border-color: #ff6b6b;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .menu-item-name {
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .menu-item-code {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }

        .menu-item-price {
            font-size: 16px;
            color: #ee5a24;
            font-weight: bold;
        }

        .add-item-form {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr auto;
            gap: 10px;
            margin-bottom: 15px;
        }

        input, button {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        input:focus {
            outline: none;
            border-color: #ff6b6b;
        }

        button {
            background: #ee5a24;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s ease;
        }

        button:hover {
            background: #d84315;
        }

        button:active {
            transform: scale(0.98);
        }

        .delete-btn {
            background: #dc3545;
            padding: 5px 10px;
            font-size: 12px;
        }

        .delete-btn:hover {
            background: #c82333;
        }

        .billing-search {
            position: relative;
            margin-bottom: 15px;
        }

        .billing-search input {
            width: 100%;
            padding: 12px;
            font-size: 16px;
        }

        .autocomplete-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 5px 5px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .autocomplete-item {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
        }

        .autocomplete-item:hover {
            background: #f8f8f8;
        }

        .autocomplete-item:last-child {
            border-bottom: none;
        }

        .bill-items {
            margin-bottom: 15px;
            max-height: 300px;
            overflow-y: auto;
        }

        .bill-item {
            display: grid;
            grid-template-columns: 1fr auto auto auto;
            gap: 10px;
            padding: 10px;
            border-bottom: 1px solid #f0f0f0;
            align-items: center;
        }

        .bill-item:last-child {
            border-bottom: none;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .quantity-btn {
            width: 30px;
            height: 30px;
            padding: 0;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .quantity-display {
            min-width: 30px;
            text-align: center;
            font-weight: bold;
        }

        .bill-total {
            font-size: 20px;
            font-weight: bold;
            text-align: right;
            padding: 15px;
            background: #fff3e0;
            border-radius: 5px;
            margin-bottom: 15px;
        }

        /* Updated payment section styles */
        .payment-box {
            background: #f0f0f0;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .payment-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .payment-input {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .payment-input label {
            font-size: 14px;
            color: #666;
            font-weight: bold;
        }

        .payment-input input {
            font-size: 18px;
            font-weight: bold;
            width: 100%;
        }

        .change-display {
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            padding: 15px;
            background: #e8f5e9;
            border-radius: 5px;
            color: #2e7d32;
            width: 100%;
        }

        .change-display.negative {
            background: #ffebee;
            color: #c62828;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .clear-btn {
            background: #6c757d;
        }

        .clear-btn:hover {
            background: #5a6268;
        }

        .complete-btn {
            background: #28a745;
        }

        .complete-btn:hover {
            background: #218838;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: #f8f8f8;
            border-radius: 5px;
            font-size: 14px;
        }

        .stat-item.total {
            background: #fff3e0;
            font-weight: bold;
            font-size: 16px;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 480px) {
            .add-item-form {
                grid-template-columns: 1fr;
            }
            
            .menu-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üå∂Ô∏è MIRCHI VILAS</h1>
            <p>Restaurant POS System</p>
        </div>

        <!-- Menu Management Section -->
        <div class="section">
            <h2 class="section-title">Menu Management</h2>
            <div class="add-item-form">
                <input type="text" id="itemName" placeholder="Item Name">
                <input type="text" id="itemCode" placeholder="Item Code">
                <input type="number" id="itemPrice" placeholder="Price (LKR)">
                <button onclick="addMenuItem()">Add Item</button>
            </div>
            <div class="menu-grid" id="menuGrid"></div>
        </div>

        <!-- Billing Section -->
        <div class="section">
            <h2 class="section-title">Billing</h2>
            <div class="billing-search">
                <input type="text" id="searchInput" placeholder="Search by item code or name...">
                <div class="autocomplete-dropdown hidden" id="autocompleteDropdown"></div>
            </div>
            
            <div class="bill-items" id="billItems"></div>
            
            <div class="bill-total">
                Total: LKR <span id="billTotal">0.00</span>
            </div>
            
            <!-- Updated payment box -->
            <div class="payment-box">
                <div class="payment-section">
                    <div class="payment-input">
                        <label>Customer Payment:</label>
                        <input type="number" id="customerPayment" placeholder="0.00" oninput="calculateChange()">
                    </div>
                    <div class="payment-input">
                        <label>Change:</label>
                        <div class="change-display" id="changeDisplay">LKR 0.00</div>
                    </div>
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="clear-btn" onclick="clearBill()">Clear Bill</button>
                <button class="complete-btn" onclick="completeSale()">Complete Sale</button>
            </div>
        </div>

        <!-- Sales Statistics Section -->
        <div class="section">
            <h2 class="section-title">Sales Statistics</h2>
            <div class="stats-grid" id="statsGrid"></div>
        </div>
    </div>

    <script>
        // Data storage
        let menuItems = [];
        let currentBill = [];
        let salesStats = {};

        // Load data from localStorage
        function loadData() {
            const savedMenu = localStorage.getItem('mirchiVilasMenu');
            const savedStats = localStorage.getItem('mirchiVilasStats');
            
            if (savedMenu) {
                menuItems = JSON.parse(savedMenu);
            } else {
                // Default menu items
                menuItems = [
                    { id: 1, name: 'Chicken Biryani', code: 'CB001', price: 850 },
                    { id: 2, name: 'Mutton Curry', code: 'MC001', price: 1200 },
                    { id: 3, name: 'Vegetable Kottu', code: 'VK001', price: 650 },
                    { id: 4, name: 'Fish Curry', code: 'FC001', price: 950 }
                ];
            }
            
            if (savedStats) {
                salesStats = JSON.parse(savedStats);
            }
            
            renderMenu();
            updateStats();
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('mirchiVilasMenu', JSON.stringify(menuItems));
            localStorage.setItem('mirchiVilasStats', JSON.stringify(salesStats));
        }

        // Add menu item
        function addMenuItem() {
            const name = document.getElementById('itemName').value.trim();
            const code = document.getElementById('itemCode').value.trim();
            const price = parseFloat(document.getElementById('itemPrice').value);
            
            if (!name || !code || !price || price <= 0) {
                alert('Please fill all fields with valid values');
                return;
            }
            
            const newItem = {
                id: Date.now(),
                name: name,
                code: code.toUpperCase(),
                price: price
            };
            
            menuItems.push(newItem);
            saveData();
            renderMenu();
            
            // Clear form
            document.getElementById('itemName').value = '';
            document.getElementById('itemCode').value = '';
            document.getElementById('itemPrice').value = '';
        }

        // Render menu items
        function renderMenu() {
            const menuGrid = document.getElementById('menuGrid');
            menuGrid.innerHTML = '';
            
            menuItems.forEach(item => {
                const menuItemDiv = document.createElement('div');
                menuItemDiv.className = 'menu-item';
                menuItemDiv.innerHTML = `
                    <div class="menu-item-name">${item.name}</div>
                    <div class="menu-item-code">${item.code}</div>
                    <div class="menu-item-price">LKR ${item.price.toFixed(2)}</div>
                    <button class="delete-btn" onclick="deleteMenuItem(${item.id})">Delete</button>
                `;
                menuItemDiv.onclick = (e) => {
                    if (!e.target.classList.contains('delete-btn')) {
                        addToBill(item);
                    }
                };
                menuGrid.appendChild(menuItemDiv);
            });
        }

        // Delete menu item
        function deleteMenuItem(id) {
            if (confirm('Are you sure you want to delete this item?')) {
                menuItems = menuItems.filter(item => item.id !== id);
                saveData();
                renderMenu();
            }
        }

        // Search functionality
        const searchInput = document.getElementById('searchInput');
        const autocompleteDropdown = document.getElementById('autocompleteDropdown');

        searchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            
            if (searchTerm.length === 0)            {
                autocompleteDropdown.classList.add('hidden');
                return;
            }
            
            const matches = menuItems.filter(item => 
                item.name.toLowerCase().includes(searchTerm) || 
                item.code.toLowerCase().includes(searchTerm)
            );
            
            if (matches.length > 0) {
                autocompleteDropdown.innerHTML = '';
                autocompleteDropdown.classList.remove('hidden');
                
                matches.forEach(item => {
                    const dropdownItem = document.createElement('div');
                    dropdownItem.className = 'autocomplete-item';
                    dropdownItem.innerHTML = `
                        <strong>${item.name}</strong> (${item.code}) - LKR ${item.price.toFixed(2)}
                    `;
                    dropdownItem.onclick = () => {
                        addToBill(item);
                        searchInput.value = '';
                        autocompleteDropdown.classList.add('hidden');
                    };
                    autocompleteDropdown.appendChild(dropdownItem);
                });
            } else {
                autocompleteDropdown.classList.add('hidden');
            }
        });

        // Hide dropdown when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.billing-search')) {
                autocompleteDropdown.classList.add('hidden');
            }
        });

        // Add item to bill
        function addToBill(item) {
            const existingItem = currentBill.find(billItem => billItem.id === item.id);
            
            if (existingItem) {
                existingItem.quantity++;
            } else {
                currentBill.push({
                    ...item,
                    quantity: 1
                });
            }
            
            renderBill();
            calculateTotal();
        }

        // Render bill items
        function renderBill() {
            const billItemsDiv = document.getElementById('billItems');
            billItemsDiv.innerHTML = '';
            
            if (currentBill.length === 0) {
                billItemsDiv.innerHTML = '<p style="text-align: center; color: #999;">No items in bill</p>';
                return;
            }
            
            currentBill.forEach((item, index) => {
                const billItemDiv = document.createElement('div');
                billItemDiv.className = 'bill-item';
                billItemDiv.innerHTML = `
                    <div>
                        <strong>${item.name}</strong><br>
                        <small style="color: #666;">LKR ${item.price.toFixed(2)} each</small>
                    </div>
                    <div class="quantity-controls">
                        <button class="quantity-btn" onclick="updateQuantity(${index}, -1)">-</button>
                        <span class="quantity-display">${item.quantity}</span>
                        <button class="quantity-btn" onclick="updateQuantity(${index}, 1)">+</button>
                    </div>
                    <div style="text-align: right; font-weight: bold;">
                        LKR ${(item.price * item.quantity).toFixed(2)}
                    </div>
                    <button class="delete-btn" onclick="removeFromBill(${index})">√ó</button>
                `;
                billItemsDiv.appendChild(billItemDiv);
            });
        }

        // Update quantity
        function updateQuantity(index, change) {
            currentBill[index].quantity += change;
            
            if (currentBill[index].quantity <= 0) {
                currentBill.splice(index, 1);
            }
            
            renderBill();
            calculateTotal();
        }

        // Remove from bill
        function removeFromBill(index) {
            currentBill.splice(index, 1);
            renderBill();
            calculateTotal();
        }

        // Calculate total
        function calculateTotal() {
            const total = currentBill.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            document.getElementById('billTotal').textContent = total.toFixed(2);
            calculateChange();
        }

        // Calculate change
        function calculateChange() {
            const total = parseFloat(document.getElementById('billTotal').textContent);
            const payment = parseFloat(document.getElementById('customerPayment').value) || 0;
            const change = payment - total;
            
            const changeDisplay = document.getElementById('changeDisplay');
            
            if (payment === 0) {
                changeDisplay.textContent = 'LKR 0.00';
                changeDisplay.classList.remove('negative');
            } else if (change < 0) {
                changeDisplay.textContent = `LKR ${Math.abs(change).toFixed(2)} DUE`;
                changeDisplay.classList.add('negative');
            } else {
                changeDisplay.textContent = `LKR ${change.toFixed(2)}`;
                changeDisplay.classList.remove('negative');
            }
        }

        // Clear bill
        function clearBill() {
            if (currentBill.length > 0 && confirm('Are you sure you want to clear the bill?')) {
                currentBill = [];
                document.getElementById('customerPayment').value = '';
                renderBill();
                calculateTotal();
            }
        }

        // Complete sale
        function completeSale() {
            if (currentBill.length === 0) {
                alert('No items in bill!');
                return;
            }
            
            const total = parseFloat(document.getElementById('billTotal').textContent);
            const payment = parseFloat(document.getElementById('customerPayment').value) || 0;
            
            if (payment < total) {
                alert('Insufficient payment!');
                return;
            }
            
            // Update sales statistics
            currentBill.forEach(item => {
                if (!salesStats[item.id]) {
                    salesStats[item.id] = {
                        name: item.name,
                        quantity: 0,
                        revenue: 0
                    };
                }
                salesStats[item.id].quantity += item.quantity;
                salesStats[item.id].revenue += item.price * item.quantity;
            });
            
            saveData();
            updateStats();
            
            // Show success message
            const change = payment - total;
            alert(`Sale completed!\nTotal: LKR ${total.toFixed(2)}\nPayment: LKR ${payment.toFixed(2)}\nChange: LKR ${change.toFixed(2)}`);
            
            // Clear bill
            currentBill = [];
            document.getElementById('customerPayment').value = '';
            renderBill();
            calculateTotal();
        }

        // Update statistics display
        function updateStats() {
            const statsGrid = document.getElementById('statsGrid');
            statsGrid.innerHTML = '';
            
            let totalRevenue = 0;
            let totalItems = 0;
            
            // Sort items by revenue
            const sortedStats = Object.entries(salesStats).sort((a, b) => b[1].revenue - a[1].revenue);
            
            if (sortedStats.length === 0) {
                statsGrid.innerHTML = '<p style="text-align: center; color: #999;">No sales data yet</p>';
                return;
            }
            
            sortedStats.forEach(([id, stats]) => {
                const statItem = document.createElement('div');
                statItem.className = 'stat-item';
                statItem.innerHTML = `
                    <span>${stats.name} (${stats.quantity} sold)</span>
                    <span>LKR ${stats.revenue.toFixed(2)}</span>
                `;
                statsGrid.appendChild(statItem);
                
                totalRevenue += stats.revenue;
                totalItems += stats.quantity;
            });
            
            // Add total row
            const totalItem = document.createElement('div');
            totalItem.className = 'stat-item total';
            totalItem.innerHTML = `
                <span>TOTAL (${totalItems} items)</span>
                <span>LKR ${totalRevenue.toFixed(2)}</span>
            `;
            statsGrid.appendChild(totalItem);
        }

        // Handle Enter key in search
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const searchTerm = this.value.toLowerCase();
                const match = menuItems.find(item => 
                    item.code.toLowerCase() === searchTerm || 
                    item.name.toLowerCase() === searchTerm
                );
                
                if (match) {
                    addToBill(match);
                    this.value = '';
                    autocompleteDropdown.classList.add('hidden');
                }
            }
        });

        // Handle Enter key in payment
        document.getElementById('customerPayment').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                completeSale();
            }
        });

        // Initialize the app
        loadData();
        renderBill();
        calculateTotal();
    </script>
</body>
</html>